<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스레드 댓글 생성기</title>
    <!-- Tailwind CSS CDN을 사용하여 스타일링 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts에서 Inter 폰트 불러오기 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 to-purple-600 min-h-screen p-8 flex items-center justify-center">
    <div class="w-full max-w-2xl bg-white bg-opacity-90 rounded-3xl shadow-2xl p-6 md:p-10 backdrop-blur-md">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-2">
            꿀정보 댓글 생성기
        </h1>
        <p class="text-center text-gray-600 mb-8">
            주제에 맞는 센스 있는 댓글을 자동으로 만들어 보세요!
        </p>

        <!-- 메시지 박스 -->
        <div 
            id="message-box" 
            class="fixed top-5 left-1/2 -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-full shadow-lg transition-opacity duration-300 opacity-0"
        >
        </div>

        <!-- 입력 및 버튼 섹션 -->
        <div class="mb-8">
            <textarea
                id="prompt-input"
                class="w-full p-4 rounded-xl border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all duration-300 resize-none text-gray-700"
                rows="3"
                placeholder="예시: 새로운 인공지능 기술에 대한 생각, 주말에 가볼 만한 맛집 추천"
            ></textarea>
            <button
                id="generate-button"
                class="w-full mt-4 py-3 px-6 rounded-xl text-white font-bold text-lg shadow-lg transform transition-all duration-300 bg-purple-600 hover:bg-purple-700 active:scale-95"
            >
                댓글 생성하기
            </button>
        </div>

        <!-- 결과 섹션 -->
        <div id="results-container" class="space-y-4">
            <!-- 댓글이 여기에 동적으로 추가됩니다 -->
        </div>
    </div>

    <script>
        // DOM 요소 가져오기
        const promptInput = document.getElementById('prompt-input');
        const generateButton = document.getElementById('generate-button');
        const resultsContainer = document.getElementById('results-container');
        const messageBox = document.getElementById('message-box');
        
        /**
         * 메시지 박스를 보여주는 함수.
         * @param {string} message 표시할 메시지 텍스트
         */
        const showMessage = (message) => {
            messageBox.textContent = message;
            messageBox.classList.remove('opacity-0');
            messageBox.classList.add('opacity-100');
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
            }, 3000);
        };

        /**
         * API 호출을 처리하고 댓글을 생성하는 함수.
         */
        const generateComments = async () => {
            const prompt = promptInput.value.trim();
            if (!prompt) {
                showMessage('댓글 주제를 입력해주세요.');
                return;
            }

            // 로딩 상태 시작
            generateButton.disabled = true;
            generateButton.textContent = '생성 중...';
            generateButton.classList.remove('bg-purple-600', 'hover:bg-purple-700', 'active:scale-95');
            generateButton.classList.add('bg-purple-300', 'cursor-not-allowed');
            
            resultsContainer.innerHTML = ''; // 기존 결과 초기화

            try {
                // API에 보낼 페이로드 설정
                const chatHistory = [{
                    role: "user",
                    parts: [{ text: `Generate 5 concise and engaging Threads comments about the following topic in Korean. The comments should be in a friendly and casual tone.\nTopic: ${prompt}` }]
                }];

                // JSON 스키마를 사용하여 구조화된 응답을 요청
                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "commentText": { "type": "STRING" }
                                }
                            }
                        }
                    }
                };

                const apiKey = "AIzaSyAa15o--RkPiaWxMfQPHznwBsmCy5uf5hw";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                const rawJson = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (rawJson) {
                    const parsedComments = JSON.parse(rawJson);
                    renderComments(parsedComments);
                } else {
                    throw new Error("Failed to parse API response.");
                }
                
            } catch (err) {
                console.error('Error generating comments:', err);
                const errorDiv = document.createElement('div');
                errorDiv.className = 'mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg';
                errorDiv.textContent = '댓글 생성 중 오류가 발생했습니다.';
                resultsContainer.appendChild(errorDiv);
            } finally {
                // 로딩 상태 종료
                generateButton.disabled = false;
                generateButton.textContent = '댓글 생성하기';
                generateButton.classList.add('bg-purple-600', 'hover:bg-purple-700', 'active:scale-95');
                generateButton.classList.remove('bg-purple-300', 'cursor-not-allowed');
            }
        };

        /**
         * 댓글 목록을 화면에 렌더링하는 함수.
         * @param {Array<Object>} comments 생성된 댓글 데이터
         */
        const renderComments = (comments) => {
            if (comments.length > 0) {
                const title = document.createElement('h2');
                title.className = 'text-xl font-semibold text-gray-700';
                title.textContent = '생성된 댓글';
                resultsContainer.appendChild(title);

                comments.forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'flex items-start bg-gray-50 rounded-xl p-4 shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-300';
                    
                    const commentText = document.createElement('p');
                    commentText.className = 'flex-grow text-gray-800 break-words whitespace-pre-wrap';
                    commentText.textContent = comment.commentText;

                    const copyButton = document.createElement('button');
                    copyButton.className = 'ml-4 flex-shrink-0 text-gray-500 hover:text-purple-600 transition-colors duration-200';
                    copyButton.setAttribute('aria-label', '클립보드에 복사');
                    copyButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7v4a1 1 0 001 1h4a1 1 0 001-1V7m0 4a2 2 0 11-4 0m4 0h1a2 2 0 012 2v4a2 2 0 01-2 2H7a2 2 0 01-2-2v-4a2 2 0 012-2h1m12 12a2 2 0 01-2-2v-4a2 2 0 01-2-2h-1M6 18h12a2 2 0 002-2v-4a2 2 0 00-2-2H6a2 2 0 00-2 2v4a2 2 0 002 2z" />
                        </svg>
                    `;
                    copyButton.addEventListener('click', () => copyToClipboard(comment.commentText));

                    commentDiv.appendChild(commentText);
                    commentDiv.appendChild(copyButton);
                    resultsContainer.appendChild(commentDiv);
                });
            }
        };

        /**
         * 클립보드에 텍스트를 복사하는 함수.
         * @param {string} text 복사할 텍스트
         */
        const copyToClipboard = (text) => {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showMessage('클립보드에 복사되었습니다!');
        };

        // 버튼 클릭 이벤트 리스너
        generateButton.addEventListener('click', generateComments);
    </script>
</body>
</html>
